{% extends 'base.html' %}
{% block title %}Lançamentos{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header d-sm-none d-md-block d-lg-block d-xl-block d-none">
      <div class="hstack gap-3">
        <a href="{{ url_for('lancamentos.create')}}" class="btn btn-outline-dark btn-sm">
          <i class="bi bi-plus-circle"></i>
          Novo Lançamento
        </a>

        <h4 class="mx-auto">Lista de Lançamentos</h4>
        <div class="vr"></div>
        
        <ul class="list-group list-group-horizontal-xl">
          <a href="{{url_for('lancamentos.index')}}" aria-current="true" class="list-group-item {{ 'active' if request.path == url_for('lancamentos.index')}}">
            Todos
          </a>
          {% for conta in contas %}
            <a href="{{url_for('lancamentos.index', conta_id=conta.id)}}" aria-current="true" class="list-group-item {{ 'active' if request.path == url_for('lancamentos.index', conta_id=conta.id)}}">
              {{conta.nome}}
            </a>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="card-header d-sm-block d-md-none d-lg-none d-xl-none">
      <div class="vstack gap-3">
        <a href="{{ url_for('lancamentos.create')}}" class="list-group-item">
          <i class="bi bi-plus-circle-fill"></i>
          Novo Lançamento
        </a>

        <h4 class="mx-auto">Lista de Lançamentos</h4>

        <ul class="list-group list-group-horizontal-xl">
          <a href="{{url_for('lancamentos.index')}}" aria-current="true" class="list-group-item {{ 'active' if request.path == url_for('lancamentos.index')}}">
            Todos
          </a>
          {% for conta in contas %}
            <a href="{{url_for('lancamentos.index', conta_id=conta.id)}}" aria-current="true" class="list-group-item {{ 'active' if request.path == url_for('lancamentos.index', conta_id=conta.id)}}">
              {{conta.nome}}
            </a>
          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="card-body p-0 table-responsive">
      <table class="table table-striped table-sm m-0">
        <thead class="table-dark">
          <tr>
            <th scope="col" class="text-center">#</th>
            <th scope="col">Data</th>
            <th scope="col">Descrição</th>
            <th scope="col">Conta</th>
            <th scope="col" class="text-end">Valor</th>
            <th class="text-center">Ações</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for lancamento in lancamentos %}
          <tr>
            <th scope="row" class="text-center">
              <a href="{{url_for('lancamentos.update', id=lancamento.id)}}">{{lancamento.id}}</a>
            </th>
            <td>{{lancamento.dtlancamento.strftime('%d/%m/%Y')}}</td>
            <td>{{lancamento.descricao}}</td>
            <td>{{lancamento.conta.nome}}</td>
            <td class="text-end {{'text-success' if lancamento.valor > 0 else 'text-danger' }}">{{lancamento.valor|currencyformat('R$') }}</td>
            <td class="text-end">
              <form method="POST" action="{{ url_for('lancamentos.delete', id=lancamento.id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
              </form>
              <!-- <a class="text-danger" href="{{url_for('lancamentos.delete', id=lancamento.id)}}">Excluir</a> -->
  <!--             <button onClick="excluir(this, {{lancamento.id}})">Excluir</button> -->
  <!--             <a data-confirm="Tem Certeza?" data-method="delete"
                href="url_for('lancamentos.delete', id=lancamento.id)">Excluir</a> -->
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
    
{% endblock %}

{% block footer %}
  {{ super() }}
{% endblock %}

{% block script %}
  {{ super() }}
  <script>

    function excluir(elemento, id){
      if(confirm('Tem Certeza?')){
        fetch('/lancamentos/delete/'+id, {
         method: 'DELETE',
         header: {
            'Accept' : 'application/json',
            'Content-Type' : 'application/json',
           }
         })
        elemento.parentElement.parentElement.remove()
        alert("lancamento removida com sucesso!");
      }
    }
  </script>
{% endblock %}